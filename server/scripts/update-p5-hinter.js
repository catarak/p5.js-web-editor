const fs = require('fs');
const process = require('process');
const axios = require('axios');

// const getDescription = (d) => {
//   return d.split('\n')[0].replace('<p>', '');
// };

axios
  .get('https://p5js.org/reference/data.json')
  .then((response) => {
    const { data } = response;

    const arr = data.classitems;
    const p5Keywords = [];

    arr.forEach((obj) => {
      if (
        obj.class === 'p5' &&
        obj.module !== 'Foundation' &&
        obj.name &&
        obj.itemtype
      ) {
        let type;
        if (obj.itemtype === 'method') type = 'fun';
        else if (obj.itemtype === 'property') type = 'var';
        else type = 'attr';

        p5Keywords.push({
          text: obj.name,
          type
        });
      }
    });

    const keywords = JSON.stringify(p5Keywords);

    let generatedCode = '/* eslint-disable */\n';
    generatedCode +=
      '/* generated: do not edit! helper file for hinter.' +
      ' generated by update-p5-hinter script */\n';
    generatedCode += `exports.p5Hinter = ${keywords};\n`;

    fs.writeFile(
      `${process.cwd()}/client/utils/p5-hinter.js`,
      generatedCode,
      (error) => {
        if (error) {
          console.log("Error!! Couldn't write to the file", error);
        } else {
          console.log('Hinter files updated successfully');
        }
      }
    );
  })
  .catch((err) => {
    throw err;
  });
